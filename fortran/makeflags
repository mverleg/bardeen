
_default:
	@echo "This makefile should be included into another one, which lists dependencies."

prep:
	mkdir -p forttmp~/fort \
		forttmp~/gmod forttmp~/gdeb forttmp~/gopt \
		forttmp~/imod forttmp~/ideb forttmp~/iopt

clean:
	/bin/rm -r -f forttmp~/ *.run

rm: clean

fort~/%.F03: %.f03
	echo $*

# gfortan debug
-Jforttmp~/gdeb/%.run: prep
	gfortran --free-form \
		-Jforttmp~/gmod \
		-Wall -Wextra -pedantic -fimplicit-none \
		-fbacktrace -fbounds-check -ffpe-trap=zero,overflow -fmax-errors=1 \
		$< \
		$+ \
		$(LIB_FLAGS) \
		-o $@
	ln -f -s $@ $*.run

# gfortran optimized
-Jforttmp~/gopt/%.run: prep
	gfortran --free-form \
		-Jforttmp~/gmod \
		-Wall -Wextra -pedantic -fimplicit-none \
		-O3 -march=native \
		$< \
		$+ \
		$(LIB_FLAGS) \
		-o $@
	ln -f -s $@ $*.run

# ifort debug
-Jforttmp~/ideb/%.run: prep
	ifort -extend-source 132 \
#		-Jforttmp~/gmod \
		-warn all -warn nounused -warn nodeclarations \
		-g -fpe0 -traceback -debug extended -check all -check bounds \
		$< \
		$+ \
		$(LIB_FLAGS) \
		-o $@
	ln -f -s $@ $*.run

# ifort optimized
-Jforttmp~/iopt/%.run: prep
	ifort -extend-source 132 \
#		-Jforttmp~/gmod \
		-warn all -warn nounused -warn nodeclarations \
		-fast \
		$< \
		$+ \
		$(LIB_FLAGS) \
		-o $@
	ln -f -s $@ $*.run



